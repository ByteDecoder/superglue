# Rails

## Setting the content location

On non-GET `visit`s, Breezy uses the response's `content-location` to create the key used to store your props.

This is because when you render in a `create` or `update`, the returned response does not necessarily reflect the url the user should see.

For example, if I'm on `posts/new` and you make a POST request to `posts/`, you may render `posts/new` for any errors you'd like to show.

It is recommended that you set this header in your `create` and `update` methods. If you used the generators, this is done for you.

```ruby
def create
  @post = Post.new(post_params)

  if @post.save
    redirect_to @post, notice: 'Post was successfully created.'
  else
    response.set_header("content-location", new_post_path)
    render :new
  end
end
```

## Rails Flash
Your Rails flash will work as expected. On the React side, you recieve the flash in the `props` of your connected component:

```
class PostsIndex extends BaseScreen {
  render () {
    const {
      flash,
    } = this.props

    ...
  }
}

export default connect(
  mapStateToProps,
  mapDispatchToProps
)(PostsIndex)

```

A few notes about the client's behavior with the flash:
1. When using `data-bz-visit`, all flash in Breezy's redux state will be cleared before the request.
2. when using `data-bz-remote`, the recieved flash will be merged with the current page's flash.

## The `RailsTag` component

With this component, you can use pass the generated HTML from your Rails view helpers to React without the need for an additional wrapper div component. The component is implemented with `dangerouslySetInnerHtml` but it builds a React component out of the outer most DOM node generated by your helper. React's click handlers will work as expected.

As an example:

```
# index.json.props

json.svg_tag inline_svg_tag(
  "icons/x-circle.svg",
  aria: true,
  class: "syos-icon",
  title: "Remove",
)
```

Then somewhere in your component

```
  render() {
    const {
      svgTag
    } = this.props

    return (
      <div>
        <h1> Hello world </h1>
        <RailsTag html={svgTag} / onClick={() => console.log('hello world')}>
      </div>
    )
  }
```

## `redirect_back_with_bzq`
A helper for your controller actions:

```ruby
def create
  redirect_back_with_bzq fallback_url: '/'
end
```

This helper has the same method signature as Rails own `redirect_back`, the difference here is that `redirect_back_with_bzq` will add the existing `bzq` parameter as part of its redirect `location`.

## props_from_form_with
A view helper that will give you the camelized attributes generated by `form_with` that can be used to passed to React. Has the same method signature as `form_with`

```ruby
json.form_props props_from_form_with(
  url: venue_floor_seats_path(venue, floor),
  method: :get,
)
```
