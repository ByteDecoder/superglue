<%ruby_versions = %w(2.5)%>
<%gemfiles = %w(Gemfile.rails60)%>

matrix:
  include:
    <%gemfiles.each do |gemfile|%>
      <%ruby_versions.each do |ver|%>
        <%next if gemfile == 'Gemfile.rails60' && ver < '2.5'%>
    - language: ruby
      rvm: <%=ver%>
      gemfile: props_template/<%=gemfile%>
      before_install:
        - cd props_template
      install:
        - bundle install
      script:
        - bundle exec rspec
      <%end%>
    <%end%>

    <%gemfiles.each do |gemfile|%>
      <%ruby_versions.each do |ver|%>
        <%next if gemfile == 'Gemfile.rails60' && ver < '2.5'%>
    - language: ruby
      rvm: <%=ver%>
      env:
        - NODE_VERSION="10.13.0"
      gemfile: breezy_rails/<%=gemfile%>
      addons:
        chrome: stable
      before_install:
        - wget -N http://chromedriver.storage.googleapis.com/83.0.4103/chromedriver_linux64.zip -P ~/
        - unzip ~/chromedriver_linux64.zip -d ~/
        - rm ~/chromedriver_linux64.zip
        - sudo mv -f ~/chromedriver /usr/local/share/
        - sudo chmod +x /usr/local/share/chromedriver
        - sudo ln -s /usr/local/share/chromedriver /usr/local/bin/chromedriver
        - nvm install $NODE_VERSION
        - node --version
        - cd breezy_rails
      install:
        - bundle install
      script:
        - bundle exec rake test
        - BUNDLE_GEMFILE='' ruby -Ilib:test test/acceptance/breezy_installation_acceptance.rb
      <%end%>
    <%end%>

    - language: node_js
      node_js: 8
      before_install:
        - cd breezy
      install:
        - npm install
      script:
        - npm run lint
        - npm run test
