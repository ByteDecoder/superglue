<%ruby_versions = %w(2.3 2.4 2.5)%>
<%gemfiles = %w(Gemfile.rails50 Gemfile.rails51 Gemfile.rails52 Gemfile.rails60)%>

matrix:
  include:
    <%gemfiles.each do |gemfile|%>
      <%ruby_versions.each do |ver|%>
    - language: ruby
      rvm: <%=ver%>
      gemfile: breezy_template/<%=gemfile%>
      before_install:
        - cd breezy_template
      install:
        - bundle install
      script:
        - bundle exec rake test
      <%end%>
    <%end%>

    <%gemfiles.each do |gemfile|%>
      <%ruby_versions.each do |ver|%>
    - language: ruby
      rvm: <%=ver%>
      gemfile: breezy_rails/<%=gemfile%>
      addons:
        chrome: stable
      before_install:
        - wget -N http://chromedriver.storage.googleapis.com/2.38/chromedriver_linux64.zip -P ~/
        - unzip ~/chromedriver_linux64.zip -d ~/
        - rm ~/chromedriver_linux64.zip
        - sudo mv -f ~/chromedriver /usr/local/share/
        - sudo chmod +x /usr/local/share/chromedriver
        - sudo ln -s /usr/local/share/chromedriver /usr/local/bin/chromedriver
        - cd breezy_rails
      install:
        - bundle install
      script:
        - bundle exec rake test
        - BUNDLE_GEMFILE='' ruby -Ilib:test test/acceptance/breezy_installation_acceptance.rb
      <%end%>
    <%end%>

    - language: node_js
      node_js: 8
      before_install:
        - cd breezy
      install:
        - npm install
      script:
        - npm run lint
        - npm run test
